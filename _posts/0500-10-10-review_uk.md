---
layout: doc
title: Перевірка даних OSM
permalink: /uk/coordination/review/
lang: uk
category: coordination
---

Перевірка даних OSM
==================

> Редакція 2017-04-24  

- TOC
{:toc}

**Цей розділ охоплює процеси перевірки якості даних, особливо в контексті керованого проєкту мапінгу в OSM, наприклад, тих, що здійснюються [Humanitarian OpenStreetMap Team](http://hotosm.org) у різних країнах та проєктами [Open Cities](http://opencitiesproject.com) у Бангладеш, Шрі-Ланці та Непалі. Продемонстровані методи можуть бути корисними і в інших контекстах, коли перевірка якості даних є регулярним завданням.**

Коли ми намагаємось мапити всі об’єкти та їх властивості на визначеній території, нам потрібно переконатись у відсутності помилок та мати методики для оцінки якості роботи. У цім посібнику ми розглянемо кілька методів перевірки даних, пояснивши кроки кожного етапу та причину, що стоїть за кожним з них.

- Щоденні перевірки
-  Повторне осбтеження
-  SQL запити

Ці методи перевірки набувають все більшого значення, оскільки модель даних зростає, а кількість зібраних об’єктів стає досить великою. Наприклад, не знадобиться багато часу та зусиль для оцінки моделі даних, яка включає лише точкових об’єктів (POI):

![Data Model POIs][]

В цьому випадку питаннями на які треба відповісти будуть:

-  Чи були замаплені всі POI?
-  Чи є POI без назви?
- Чи є POI тип яких не зазначений?
- Чи є POI у яких не зазначено номер телефону?
-  Чи назва в полі name написана з великої літери?
-  Чи має значення номеру телефону хоча б якийсь сенс?

Однак, як правило, модель даних набагато складніша, як і у випадку з мапінгом будівель. Розглянемо модель даних, яка включає в себе:

![Data Model Buildings][]

Можливо ви вже замапили не одну тисячу будівель, що мали багато різних атрибутів, тож їх перевірка є важливою. Тут ми будемо використовувати будівлі як приклад, але цей метод також можна застосовувати й для інших типів об’єктів.

Щоденні перевірки
------------

Перевірка даних на щоденній основі – є наріжним методом оцінки їх якості. Її бажано проводити, як зазначено, кожного дня, але не рідше ніж раз на тиждень. Для керівника команди маперів це є важливим завданням, оскільки своєчасне виявлення помилок допомагає їх найскорішому виправленню, та дозволяє внести зміни в процес та звернути увагу маперів на них. 

Розглянемо кілька методів перевірки даних з використанням JOSM. Ось деякі питання на які ми маємо знайти відповідь щодо даних:

-  Чи у нас є помилки ***топології*** (коли контури будинків перетинають друг друга або у нас помилкові зв’язки [relations])?
-  Чи є у нас помилки в ***теґах*** (помилкові значення, друкарські помилки, невідповідні пари ключ=значення)?
-  Чи є наші дані ***повними*** згідно з нашою моделлю даних?

Спробуймо відповісти на ці питання користуючись JOSM. Вважатимемо, що ми перевіряємо роботу інших, але ті ж принципи добре працюють (і є можливо простішими), коли ми перевіряємо власну роботу.

Будемо використовувати тренувальні дані з проєкту Open Cities для міста Дака (Dhaka). Завантажте собі для подальшої роботи файл: [dhaka_validation_example.osm](http://learnosm.org/files/dhaka_validation_example.osm)

**НЕ НАМАГАЙТЕСЬ завантажити ваші зміни до OpenStreetMap. Ці дані лише для демонстрації процесу перевірки.**

![Dhaka Example in JOSM][]

### Перевірка даних
Першим кроком перевірки буде використання вбудованих в JOSM інструментів перевірки даних, які дозволяють в автоматичному режимі знаходити потенційні помилки. Ці інструменти особливо корисні для пошуку помилок ***топології***, але можуть не спрацювати для пошуку помилок в теґах.

-  Активуйте вікно Результати перевірки натиснувши на кнопку на панелі інструментів ліворуч. (Це необов’язково робити якщо у вас вже відкрите це вікно)

![Validation Tool][]

-  Далі, переконайтесь що у вас не виділено жодного об’єкта на мапі, можна просто клацнути в порожнє місце на мапі для скидання виділення. Якщо у вас виділено якісь об’єкти під час запуску Перевірки, всі перевірки будуть здійснені тільки дня них. (Іноді у вас може виникнути потреба перевірити лише деякі об’єкти, але зараз ми хочемо перевірити весь файл).
-  Натисніть кнопку “Перевірка” (“Validation”) у вікні.

![Validate Button][]

-  Після виконання перевірок ви побачите перелік попереджень:

![Validation Results][]

-  Також у вікні шарів ви побачите появу нового шару, який показує помилки на мапі. Зараз його можна приховати.

![Validation Layer][]

Переглянемо кілька попереджень. Ви можете побачити що у нас чотири випадки перетину контурів будинків попередження “Crossing buildings”. Це означає, що десь контури будинків перекривають друг друга. Виділіть перший елемент в списку, клацніть правою кнопкою миші та оберіть “Zoom to problem”.

![Validation Zoom to Problem][]

Натисніть кнопку “Вибрати” (“Select”) у вікні Валідатора, щоб підсвітити підозрілі об’єкти. Ми побачимо що проблема з цими двома контурами:

![Validation Selected Ways][]

-  Таку помилку майже не можливо знайти без допомоги інструментів перевірки даних. Якщо ви наблизитесь достатньо близько, ви зможете побачити що тут є невеличке перекриття між контурами будинків, що є помилкою топології, через те що будинки, як правило не перетинаються. Для виправлення помилки треба посунути точку посередині. Якщо будинки стоять впритул, що найвірогідніше, середню точку треба зробити спільною приєднавши її до контуру сусідньої будівлі.
-  Після того, яки ми виправили цю помилку, можна запустити перевірку ще раз, попередження має зникнути зі списку.

Цей метод автоматичної перевірки даних є ефективним способом виправлення помилок топології, особливо тих, які важко помітити людині. В переліку попереджень можна також побачити інші повідомлення, наприклад “Будівля в середині будівлі” (“Building inside building”), що є результатом подібної помилки.

Ще інші попередження, такі як “Перетин доріг/водних шляхів” (“Crossing waterway/highway”) – не завжди є помилками. Це свідчить, що інструменти перевірки добре працюють для пошуку потенційних помилок, але для вирішення того чи є ці помилки критичними потрібен певний досвід.

![Validation Crossing Ways][]

Розглянемо попередження “Лінії зі схожими назвами” (“Similarly named ways”) – це вже не пов’язано з топологічними помилками. Натисніть “Вибрати” (“Select”) для виділення двох ліній, щодо яких є сумніви.

![Validation Select Crossing Ways][]

Чи ви можете сказати в чому помилка? Тут у нас два відрізки дороги, які насправді є частинами однієї дороги, але мають невелику відмінність в назві – слово “road” в одного з відрізків написане з великої літери, а в іншого з маленької. Зрозуміло що вони мають називатись однаково, в цьому випадку треба писати “road” з великої літери для обох відрізків.

### Використання пошуку в JOSM
Пошук у JOSM – це потужний спосіб перегляду даних. Він дозволяє вам використовувати пошукові запити, щоб вибрати лише потрібні вам об’єкти.

-  Щоб відкрити вікно пошуку, в меню Правити знайдіть пункт Пошук… або натисніть CTRL + F.

![JOSM Menu Search][]

-  До ваших послуг велика кількість типів пошукових запитів, приклади та певна інформація знаходяться безпосередня у вікні пошуку, або ж ви завжди можете скористатись “Довідкою”.
-  Спробуємо зараз знайти всі будівлі. Кожна з них має бути позначена теґом ***building=yes***, а деякі –  ***building=construction***. Ми можемо скласти запит який виглядає так:

    *building = yes* OR *building=construction*

-  З його допомогою ми вибілимо всі будівлі, але на всяк випадок, якщо хтось застосував неправильний теґ, ми скористаємось запитом, який покаже нам всі будівлі що мають ключ ***building***.

![JOSM Search String][]

-  В результаті всі будівлі будуть виділені.

Чудово, яле як це може нам допомогти в перевірці даних? Що ж, тепер коли ми маємо виділеним однотипні дані, ми можемо перевірити їх на правильність заповнення

-  Погляньте на вікно властивостей, у нас є теґи всіх виділених об’єктів. У них є однакові ключі, але через те що кожен об’єкт має своє власне значення, всі значення відмічені як *<different\>*.

![JOSM Search Properties][]

-  Оберіть ключ ***building:use*** та натисніть “Правити” (“Edit”).

![JOSM Search Properties Edit][]

- ОБЕРЕЖНО! Нам не треба зараз нічого змінювати та натискати “Так”, тому що зміни будуть застосовані до всіх виділених об’єктів. **Це було б дуже погано.**
-  Натомість, розкрийте випадаюче меню поля Значення (Value).

![JOSM Search Properties Edit 2][]

- Зверніть увагу, що всі елементи, виділені жирним шрифтом, мають цифри поруч із собою. Це кількість виділених об’єктів, які мають це значення теґу.

Ми можемо порівняти їх з теґами OpenStreetMap, які були використані в нашій моделі даних, та шукати помилки. Наприклад, цим теґом позначається для яких цілей використовується будівля. Раніше в проєкті Open Cities Dhaka, звідки ми взяли ці дані, не було узгоджено яким чином позначати будинки які мають багатоцільове призначення: ***building:use=multipurpose*** чи ***building:use=mixed***. Оскільки перший теґ вже використовувався в інших країнах, було вирішено дотримуватись такої практики. Однак, ми бачимо, що один із будинків позначено як ***mixed***. Нам треба це виправити. (Інший наочна помилка – три різних варіанти для гаражів \[***garage***\], але ми не будемо робити виправлення прямо зараз).

-  Ми не можемо змінити об’єкт з теґом ***building:use=mixed*** тут, бо у нас виділено кілька сотень інших будівель. Тож для виправлення помилки нам потрібно знайти об’єкт що її містить. Як? Правильно – за допомогою Пошуку.
-  Натисніть “Скасувати” (“Cancel”) щоб закрити це вікно. **Пам’ятаєте, натискання Так – небезпечне.**
-  Викрийте вікно Пошуку та введіть наступний пошуковий запит:
    *"building:use"=mixed*
-  Бачите, ми взяли ключ з двокрапкою (:) в лапки. Двокрапка також може бути елементом синтаксису пошукових запитів. Виконання цього запиту дозволить виділити нам один будинок, що має ключ з зазначеним значенням. Тепер ми можемо виправити значення на ***multipurpose***.

**Пам’ятайте, якщо ви намагаєтесь повторювати всі дії з цих настанов, НЕ НАМАГАЙТЕСЬ завантажити ваші зміни до OpenStreetMap. Ці вправи надано лише для демонстрації можливостей.**


Повторне осбтеження
------------
При керуванні таким проєктом, як додавання будівель, повинен бути додатковий метод контролю якості, як для поліпшення роботи, так і для звітування про точність в кінці проєкту.

Якщо в проєкті беруть участь кілька команд маперів, ймовірно що не всі вони працюють з однаковим рівнем якості. Навіть найкраща команда може припускатись помилок. Уявіть що кожна команда додає на мапу по 100 будинків кожного дня і досить можливо, що невеликий відсоток атрибутів, які вони внесли, можуть бути не точними.

Таким чином, хороший проєкт буде містити процес повторної перевірки деяких виконаних робіт, виправлення помилок, визначення того, які групи маперів працюють з прийнятним рівнем якості, а також оцінювання відсотку помилок для підсумкового звіту.

Звісно, немає потреби в повторному досліджені всіх будинків на території проєкту, але 5-10% мають бути перевірені. Місця для перевірки треба обирати випадково, але так щоб можна було порівняти роботу різних команд. Команди можуть перевірити роботу друг друга, а за можливості це можна доручити найбільш досвідченим маперам. Поширеною практикою є витрачання менеджерами одного з днів тижня на часткову перевірку території проєкту. 

### Виправлення помилок
Що треба робити під час виявлення помилок?

Якщо відсоток помилок є порівняно не великим (не більше 5% всіх будівель), про проблему треба сповістити команду що виконувала завдання, щоб вони самотужки виправили помилки та не робили їх в майбутньому. Виправлення мають бути збережені в OpenStreetMap, а результати перевірки записані.

Якщо виявлено вищий рівень помилок, мають бути застосовані більш рішучі заходи. Про це треба відповідним чином повідомити виконавців, а територію, можливо, доведеться перевірити повністю, в залежності від критичності виявлених помилок. Відсоток помилок вищий за 10% скоріш за все є не прийнятним.

### Звітування про точність
The second goal of resurveying is so that you can report on the accuracy of the data when the project closes.  Users of the data will want to know your metrics and methodologies of assessing the data quality.

By including this process as part of your reviewing methodology, you will be able to clearly explain how you assessed the data quality, and provide hard numbers that show the likely percentage of error contained in your survey data.

For example, let’s imagine that we are managing a project which maps 1000 buildings.  So we decide to map 10% of them, or 100 buildings, randomly selected from the target area.  We go out and find that of the 100 buildings we resurveyed, six of them have a high level of inaccuracy.  Let’s say we define inaccuracy by having more than one attribute incorrect.  So six percent of the resurvey is wrong - we can fix these mistakes, but we still must extrapolate that about six percent of all 1000 buildings are probably inaccurate.  This should be reported as the probable error at the close of the project.

Resurveying ought to be done throughout the project.  Imagine that we waited until the end in this example and 40 out of 100 buildings were wrong!  It might ruin the entire project.  It is better to catch large-scale mistakes early so that they can be corrected.


SQL Queries
-----------
Probably the best analysis tool is going to be running SQL Queries in a GIS system, such as Quantum GIS.  This is similar to searching for data in JOSM, but it offers more powerful analysis, though it can take a little more time to set up.  Using JOSM is a quick, regular way to check for basic errors, whereas querying in QGIS is better suited for finding missing data or incorrect attributes.

We’ll assume here that you are somewhat familiar with GIS, and focus on building queries which can help you to review OpenStreetMap data.  For the exercises below we’ll again be using data from the Open Cities Dhaka project, which you can download at [dhaka_sql.zip](http://learnosm.org/files/dhaka_sql.zip).  The OpenStreetMap data was exported using the HOT Export Tool ([export.hotosm.org](http://export.hotosm.org)) and the target area boundary was defined at the start of the project.

### Prepare the Data
Unzip the files and load the two shapefiles into QGIS.  We’ll begin by clipping only the buildings within the project area, to make our queries more simple later on.

- First let’s select only the polygons that are within the target area.  To do this we will use the Spatial Query Plugin.  If you do not already have it installed, go to Plugins -> Manage and Install Plugins to find and install it.
- Go to Vector -> Spatial Query -> Spatial Query.
- You should fill in settings to select features from **planet_osm_polygon** that are **within target_area**.

![QGIS Spatial Query][]

- Click Apply. Only polygons within the target area will be selected.

![QGIS Map Image][]

- Right-click on the layer and save the selection as a new shapefile.  Add it to the project.

![QGIS Save Selection As][]

- Next let’s filter only the polygons that are buildings and that were collected as part of this project.
- Right-click on **planet_osm_polygon** and click on “Filter...”
- Enter the following query:
    
*"building" != NULL AND "source" = 'Open Cities Dhaka Survey'*

- Click OK.  Filtering the data with this query will only show polygons that have something in the building column.  It also removes buildings that do not have the source tag associated with this project.
- Save this data as a new shapefile.  We will use this file for our SQL queries.

![QGIS Map Image 2][]

### SQL Queries
We can now run queries on the buildings layer to find possible mistakes.  Let’s think about some things that we might want to query.  The data model from this project indicates attributes that should be collected for every building - they are:

- name
- building
- building:levels
- building:use                                            
- building:vertical_irregularity
- building:soft_storey
- building:material
- building:structure
- start_date
- building:condition

Note that in the shapefile these attribute names are truncated, since column named are limited to 10 characters.

So what sort of questions do we want to ask?  What are likely mistakes?  One common mistake is that a building was mapped, but not all of the attributes were collected.  So we will want to run a query that shows all the buildings which do not have a complete set of attributes.  Of course, for some attributes, like name and start_date (construction year), it is perfectly fine for them to be empty, because not every building has a name and sometimes the construction year is unknown.  But the other attributes should always be collected.

Let’s try to develop a query for this:

- Right-click on the buildings layer (the layer we created in the previous section) and click “Filter...”  This will open the query builder.  Here we can write complex queries to return only the data we want.
- You can build your own query by double-clicking on the fields, operators, and values, or you can copy the query that we have built here:

*"building_c" = NULL OR "building_s" = NULL OR "building_l" = NULL OR "building_m" = NULL OR "vertical_i" = NULL OR "soft_store" = NULL OR "building_u" = NULL*

- Click “Test” and you will see that this query returns 125 features.  This means that of the 3500 or so buildings that have been mapped, 125 of them are missing one or more of these attributes.

![QGIS Query Result][]

- Click OK to show only those buildings that meet the conditions in the query.

![QGIS Map Image 3][]

- These buildings can then be examined more closely to identify which attributes are missing, and if they need to be resurveyed.  It is then possible to use QGIS to create a map which a re-survey team could take to correct the missing building attributes.

What are some other queries that might be of use?  Well, you may also want to check for attributes that are not contained within your data schema.  We did this in the JOSM search section.  You can use a query to find all the buildings whose attributes don’t fit within your data model.

You may also use this to look for anomalies, which are probably but not necessarily mistakes.  For example, if we open the query builder, select **building_l**, and click “All” to load all the possible attribute values, we see that most buildings have a number between one and 20 (This attribute is building:levels, the number of storeys in the building).  But there is also a 51 in there.  It seems unlikely that there will be a 51 storey building towering above everything in this area, so we can locate it and make a note to check this with the mappers.

Querying can be an effective way to look for possible mistakes in the data set.  Combined with other features of QGIS, it can be used to output maps that can be used for reviewing the data in an area.


Summary
-------
In this tutorial we’ve gone through several effective methods of maintaining data quality during a project and done some hands-on exercises to practice reviewing OSM data.  When organizing a mapping project, or even when assessing the data in an area for personal use, these methods may come in handy.



[Data Model POIs]: /images/coordination/reviewing_osm_data_image01.png
[Data Model Buildings]: /images/coordination/reviewing_osm_data_image02.png
[Dhaka Example in JOSM]: /images/coordination/reviewing_osm_data_image03.png
[Validation Tool]: /images/coordination/reviewing_osm_data_image04.png
[Validate Button]: /images/coordination/reviewing_osm_data_image05.png
[Validation Results]: /images/coordination/reviewing_osm_data_image06.png
[Validation Layer]: /images/coordination/reviewing_osm_data_image07.png
[Validation Zoom to Problem]: /images/coordination/reviewing_osm_data_image08.png
[Validation Selected Ways]: /images/coordination/reviewing_osm_data_image09.png
[Validation Crossing Ways]: /images/coordination/reviewing_osm_data_image10.png
[Validation Select Crossing Ways]: /images/coordination/reviewing_osm_data_image11.png
[JOSM Menu Search]: /images/coordination/reviewing_osm_data_image12.png
[JOSM Search String]: /images/coordination/reviewing_osm_data_image13.png
[JOSM Search Properties]: /images/coordination/reviewing_osm_data_image14.png
[JOSM Search Properties Edit]: /images/coordination/reviewing_osm_data_image15.png
[JOSM Search Properties Edit 2]: /images/coordination/reviewing_osm_data_image16.png
[QGIS Spatial Query]: /images/coordination/reviewing_osm_data_image17.png
[QGIS Map Image]: /images/coordination/reviewing_osm_data_image18.png
[QGIS Save Selection As]: /images/coordination/reviewing_osm_data_image19.png
[QGIS Map Image 2]: /images/coordination/reviewing_osm_data_image20.png
[QGIS Query Result]: /images/coordination/reviewing_osm_data_image21.png
[QGIS Map Image 3]: /images/coordination/reviewing_osm_data_image22.png



