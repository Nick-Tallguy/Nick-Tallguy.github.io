---
layout: doc
title: Виправлення зсуву зображень
permalink: /uk/josm/correcting-imagery-offset/
lang: uk
category: josm
---

Зсув зображення
===============

> Редакція 2015-09-21  

Постачальники знімків зазвичай роблять дуже багато роботи по прив’язуванню їх знімків до місцевості, але іноді трапляється так, що знімки є зсунутими. Це досить часто помітно в гірських районах та в місцях перепаду висот, на пагорбах, там де доволі важко розтягнути пласке зображення так, щоб воно правильно лягло на всі нерівності рельєфу. Завантажуючи зображення в JOSM можна помітити, що в таких випадках воно може бути зсунутим на десять на навіть більше метрів від справжнього свого положення. Такі випадки називаються **зсувом фонового зображення** (**imagery offset**).  

Помітили, на зображенні два знімки були прив'язані та зшиті в один. Але через те що прив’язування зображень до місцевості це дуже складний процес, два знімки виявились такими, що не стикуються добре один з одним. Отже, один чи обидва знімки є не точно прив’язаними.  

![Misaligned imagery][]

Ми вже знаємо що мапи можна створювати двома способами – використовуючи аерофотознімки, обкреслюючи предмети, які на них можна розпізнати, або використовуючи записані GPS-треки та дорожні точки, щоб перенести їх на мапу в OpenStreetMap. Переваги аерофотознімків є незаперечними. Вони дозволяють нам, маперам, бачити всю картину повністю, спираючись на наше знання місцевості та вміння розрізняти об’єкти, дозволяють швидко додавати на мапу дороги, будівлі та зонувати території. Перевагою GPS-треків у порівнянні з аерофотознімками є їх менша схильність до зсуву положення. Пристрої GPS завжди нададуть нам більш точну інформацію про довготу та широту. Правда і тут будуть виключення, коли на шляху GPS-сигналу трапляються перешкоди у вигляді високих будинків, гір, дерев, але їх просто розпізнати та ідентифікувати як помилки.  

![Aerial vs GPS][]

Отже, з того що нам відомо, ми знаємо, що GPS-треки є точнішими, а зображення під ними можуть бути зміщеними. Тож постає питання – “Якщо зображення зміщене, як ми можемо використовувати його для створення точних мап?”  

Виправлення зсуву зображень
-------------------------

Відповідь на запитання полягає в тому, що ми можемо рухати зображення так, щоб підлаштувати його положення під речі, про які нам відомо що вони знаходяться точно на своєму місці, це наші треки GPS. Зробити це в JOSM зовсім не важко.  

Найкраще для цього використовувати GPS-треки, що проходять по дорогах. І чим більше у вас є треків, тим точніше ви можете підлаштувати положення знімків. Дякуючи учасникам OpenStreetMap, які завантажують свої треки в базу OSM, ми можемо завантажити їх собі для того щоб перевірити та підлаштувати положення аерофотознімків.  

- Натисніть кнопку для завантаження даних. ![JOSM download button][]{: height="24px"}  

- Позначте прапорцем пункт “Дані GPS” (“Raw GPS Data”) ![Download raw GPS data][]{: height="24px"} вгорі вікна завантаження даних. Обведіть ділянку для завантаження та натисніть на кнопку  “Завантажити” (“Download”).  

- Це дозволить вам отримати додатковий шар в JOSM, який міститиме треки GPS. В залежності від кількості треків, які учасники проєкту розмістили на сервері, ви побачите кілька треків (або не побачите, якщо треків немає):  

![Few GPS tracks from OSM][]

- Або, ви побачите багато треків:  

![Many GPS tracks from OSM][]

- Для підлаштування положення зображення натисніть на кнопку “Налаштування положення фону” (“Adjust imagery offset”) ![Adjust imagery offset button][]{: height="24px"} на панелі інструментів JOSM вгорі.  

- Не звертайте уваги на вікно, що з’явиться, потягніть зображення з допомогою миші, так щоб вона стало в правильне місце під треками GPS. Треки GPS мають бути поверх доріг на знімку якомога точніше. У вікні ви побачити цифри, що означають зсув вашого фону.  

![Adjust imagery offset][]

- За бажанням, ви можете зберегти параметри зсуву в закладки додавши назву та натиснувши кнопку Так. Потім ви зможете застосувати ті ж самі параметри зсуву перейшовши в меню Фон ‣ Положення фону та обравши потрібну закладку.  
- Якщо у вас немає бажання створювати закладку, просто натисніть кнопку Так, без додавання назви.  

Що робити, якщо, а ні у вас, а ні в OpenStreetMap треків немає? Без GPS-треків доволі складно перевірити та підлаштувати положення знімків. Якщо це порівнянню незамаплена територія, ви можете припустити що зсуву немає та розпочати додавати дані, щоб уточнити їх пізніше. Краще мати дані що зміщені на 20-30 метрів, ніж не мати їх взагалі.  

Якщо ви зможете точно визначити широту та довготу певного об’єкта на землі, ви можете перевірити, що зображення розміщено правильно, виконавши наступні кроки:  

1. Знайдіть цей об’єкт на знімку.  
2. Натисніть на показники широти та довготи у лівому нижньому кутку JOSM. ![JOSM lat lon][]{: height="24px"}  
3. У вікні, що відкриється, введіть відомі вам широту та довготу та масштаб в метрах, десь 5-10 метрів.  
![JOSM lat lon dialogue][]
4. Це призведе до переміщення до точки з вказаними координатами. Тепер ви можете рухати зображення, як ви робили це раніше, так щоб відомий вам об’єкт опинився у центрі екрану.  

Якщо, з іншого боку, територія вже замаплена, можна сподіватись що попередні учасники накреслили об’єкти перевіривши розташування знімків. В такому випадку, ви можете підлаштувати положення знімків, розташувавши їх під мапою OSM, але будьте обережні! Можливо інші мапери не знали про зсув знімків і вони могли розташувати об’єкти з помилками, не врахувавши зсув знімків.  


База даних зсувів знімків
---------------------------

Тепер ви знаєте про зсув знімків, як його ідентифікувати та підправити положення знімків, але з цим підходом існує інша проблема, якої ми ще не торкнулися. Якщо кожен учасник OpenStreetMap підлаштовуватиме положення знімків на власний розсуд, то кожен буде мапити з трохи різними параметрами зсуву фонового зображення.  

Уявіть, що ви мапите невеличке місто, та з’ясували, що зсув знімків Bing тут 15 метрів на північ. Тож ви підлаштовуєте положення фону і потім точно мапите все місто. Але, потім, хтось інший бажає уточнити деякі деталі, він завантажує дані,  відкриває знімки Bing, але йому нічого не відомо про зсув яким ви користувались! Він вважає що хтось інший додав об’єкти на мапу зі зсувом у 15 метрів, і він починає пересувати їх, що є невірним! Це може завдати невиправної шкоди даним міста!  

Тому, дуже важливо, щоб всі учасники знали про зсув знімків, і щоб вони завжди перевіряли його перед тим як мапити. Для розв’язання цієї проблеми, був створений втулок, який дозволяє зберігати інформацію про зсув зображення в спільній базі даних та обмінюватись нею з іншими. Розглянемо як це працює:  

- Відкрийте Налаштування JOSM, перейдіть на вкладку Втулки.![JOSM plugins tab][]{: height="24px"}  

- Знайдіть втулок “imagery_offset_db” та позначте його прапорцем.  

![Imagery_offset_db plugin][]

- Натисніть кнопку Так. Можливо, вам доведеться перезапустити JOSM, щоб активувати встановлений втулок.  

Так само, як ви зберігали параметри зсувів в закладки, втулок дозволяє зберігати їх в загальній базі даних, та надає доступ до зсувів, доданих іншими користувачами. Отже, якщо хтось записав параметри зсуву для певної території, інші учасники можуть їх отримати та використовувати під час мапінгу.  

Під час використання аерофотознімків, треба ЗАВЖДИ перевіряти наявність зсувів для них, а коли ви додаєте власні – зберігати їх в базі.  


Використання інформації про зсув знімків з бази даних
------------------------------------

Під час додавання шару з аерофотознімками JOSM попереджатиме вас про необхідність перевірити їх положення, а втулок про те що ви можете перевірити наявність зсувів в базі. Ви побачите значок зі знаком оклику червоного кольору на панелі інструментів, схожий на цей:  

![Imagery offset notification][]

- Натисніть на нього, щоб втулок звернувся до бази даних та перевірив наявність зміщень для цієї території.  
- Тут ми маємо завантажені з OSM дані та GPS-треки в Кута, Балі, Індонезія. Ми бачимо, що наявний знімок має інформацію про параметри зсуву. Натисніть на кнопку щоб застосувати параметри до знімка.   

![Offset in Kuta bali][]

- Це призведе до зміни зсуву фону. Однак, коли ми використовуємо параметри зсуву, що були додані іншими маперами, ми маємо перевірити чи вони все ще є вірними по треках GPS.  

![Comparing imagery offset from GPS tracks][]

- Ми можемо бачити, що фонове зображення має неправильні параметри зсуву. Для того щоб вберегти інших від використання помилкових чи застарілих даних, ми можемо позначити цю інформацію в базі даних, як застарілу та некоректну. Натисніть на кнопку “Зсув” (вона вже не матиме червоного знаку оклику).  

![Offsets button][]

- Цього разу, у вікні натисніть правою кнопкою миші на зсув та оберіть “Вилучити зсув” (“Deprecate Offset”).  

![Deprecate offset][]

- Натисніть Так щоб підтвердити ваше бажання.  
- Вам також доведеться додати пояснення, чому ви бажаєте позначити ці параметри непридатними до використання.  

![Deprecate reason][]


Додавання інформації про зсув в базу даних
------------------------------------

Після того, як ми позначили параметри зсуву “застарілими”, нам треба додати нові дані в базу.  

1. Натисніть на кнопку “Налаштування положення фону” (“Adjust imagery offset”). ![Adjust imagery offset button][]{: height="24px"}  
2.  Підлаштуйте положення знімку, скориставшись GPS-треками. Та натисніть кнопку Так.  
3.  Перейдіть в меню Положення ‣ Збереження зміщення фону… (Offset ‣ Store Imagery Offset…)  
![Store imagery offset][]
4.  Додайте опис зміщення в наступному вікні.  
![Offset description][]
5.  Натисніть Так, щоб зберегти ваші параметри в базі.  
6.  Тепер приховаємо шар GPS та подивимось на дані OSM та порівняємо їх з вирівняним фоновим зображенням.  

![Corrected imagery][]

От халепа! Хтось замапив цю ділянку без врахування зміщення знімків, тепер доведеться витратити час щоб привести все до ладу.


Веб-сайт бази даних зміщення знімків
--------------------------------

Нарешті, для отримання додаткової інформації про зміщення з бази даних можна відвідати веб-сайт за адресою <http://offsets.textual.ru/>.  На ньому містяться всі завантажені в базу дані, там також є мапа на якій показуються всі дані і де вони розташовані:  

![http://offsets.textual.ru/][]

> Останнє, що потрібно пам’ятати, – це те, що зображення можуть не мати однакове змішення всюди! Особливо це стосується регіонів, де багато пагорбів та гір. Тож якщо зображення зміщено по-різному в різних областях, вам потрібно буде зміщувати його кожного разу знову.  

Підсумки
--------

Коли ви тільки починаєте OpenStreetMap, вам не потрібно занадто турбуватися про зміщення зображень. Але якщо ви бачите зміни іншого мапера, які здаються неузгодженими із зображенням, завжди слід враховувати, що може існувати зміщення знімків, перш ніж ви почнете змінювати додані ним об’єкти. І якщо ви ще не готові до роботи зі зміщеними знімками, просто запам’ятайте, що іноді краще мати дані зі зміщенням у 20-30 метрів ніж не мати їх взагалі. Але завжди пам’ятайте, що зображення може мати зміщення. Використовуйте кроки, описані тут для того щоб підлаштувати його за потреби.


[Misaligned imagery]: /images/josm/misaligned-images.png
[Aerial vs GPS]: /images/josm/aerial-vs-gps.png
[JOSM download button]: /images/josm/josm-download-button.png
[Download raw GPS data]: /images/josm/raw-gps-data.png
[Few GPS tracks from OSM]: /images/josm/osm-gps-tracks-few.jpg
[Many GPS tracks from OSM]: /images/josm/osm-gps-tracks-many.jpg
[Adjust imagery offset button]: /images/josm/adjust-imagery-offset-button.png
[Adjust imagery offset]: /images/josm/adjust-imagery-offset.png
[JOSM lat lon]: /images/josm/josm-lat-lon.png
[JOSM lat lon dialogue]: /images/josm/josm-lat-lon-dialogue.png
[JOSM plugins tab]: /images/josm/josm-plugins-tab.png
[Imagery_offset_db plugin]: /images/josm/imagery-offset-db-plugin.png
[Imagery offset notification]: /images/josm/offset-exclamation.png
[Offset in Kuta bali]: /images/josm/offset-kuta-bali.png
[Comparing imagery offset from GPS tracks]: /images/josm/offset-compare-gps.png
[Offsets button]: /images/josm/offsets-button.png
[Deprecate offset]: /images/josm/deprecate-offset.png
[Deprecate reason]: /images/josm/deprecate-reason.png
[Store imagery offset]: /images/josm/store-imagery-offset.png
[Offset description]: /images/josm/offset-description.png
[Corrected imagery]: /images/josm/correctly-placed.png
[http://offsets.textual.ru/]: /images/josm/offset-website.png










